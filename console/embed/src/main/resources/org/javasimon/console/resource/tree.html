<!DOCTYPE html>
<html>
    <head>
        <title>Simon Console: Tree</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link  href="resource/css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css" />
        <link  href="resource/css/javasimon.css" rel="stylesheet" type="text/css" />
        <script src="resource/js/jquery-1.7.1.min.js" type="text/javascript"></script>
        <script src="resource/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
        <script src="resource/js/javasimon-filter.js" type="text/javascript"></script>
        <script src="resource/js/javasimon-dataTreeTable.js" type="text/javascript"></script>
        <script type="text/javascript">
$(document).ready(function() {
	var oFilterCtrl=new javasimon.FilterController();
	oFilterCtrl.fnGetVal=function() {
		return {};
	};
	document.oFilterCtrl=oFilterCtrl;
	$('#listLink')
		.button();
	$('#refreshButton')
		.button({label:"Refresh",icons: {primary: "ui-icon-search"}})
		.click(function() {document.oDataTreeTable.fnReloadAjax(); return false; });
	$('#resetAllButton')
		.button({label:"Reset all", icons: {primary: "ui-icon-trash"}})
		.click(function() {
			if (window.confirm("Are you sure you want to reset all monitors?")) {
				document.oFilterCtrl.fnAjaxPost('data/reset', function() {
					document.oDataTreeTable.fnReloadAjax();
				});
			}
			return false;
		});
	$('#xmlButton')
		.button({label:"XML",icons: {primary: "ui-icon-script"}})
		.click(function() {document.oFilterCtrl.fnGoToUrl('data/tree.xml'); return false; });
	var eTable=document.getElementById('dataTreeTable');
	var oDataTreeTable=new javasimon.DataTreeTable(eTable,{
			aoColumns:[
				{sTitle:"Counter",	sField: "counter",	sClass:"number"},
				{sTitle:"Total",	sField: "total",	sClass:"number" },
				{sTitle:"Min",		sField: "min",		sClass:"number" },
				{sTitle:"Mean",		sField: "mean",		sClass:"number" },
				{sTitle:"Max",		sField: "max",		sClass:"number" },
				{sTitle:"Std Dev",	sField: "standardDeviation",sClass:"number" },
				{sTitle:"Last",		sField: "last",		sClass:"number" },
				{sTitle:"First Date",	sField: "firstUsage",	sClass:"date" },
				{sTitle:"Last Date",	sField: "lastUsage",	sClass:"date"  }
			]
		}
	);
	oDataTreeTable.fnGetCellValue=function(oNode,oColumn,nColumnIndex) {		
		var sValue=oNode.oData[oColumn.sField];
		if (nColumnIndex===0) {
			if (oNode.oParent===null) {
				if (sValue==="") {
					sValue="Root";
				}
			} else {
				var sParentValue=oNode.oParent.oData[oColumn.sField];
				if (sValue.substring(0,sParentValue.length)===sParentValue) {
					sValue=sValue.substring(sParentValue.length);
					if (sValue.charAt(0)==='.') {
						sValue=sValue.substring(1);
					}
				}
			}		
		}
		return sValue;
	};
	oDataTreeTable.fnReloadAjax=function() {
		var oDataTreeTable=this;
		$.ajax({
			url: "data/tree.json",
			context: this,
			success: function(oData) {
/* Data for testing purposes 
				var oData={id:0,name:"",children:[
					{id:1,name:"Child 1",children:[
						{id:11,name:"Child 1.1",children:[],counter:1},
						{id:11,name:"Child 1.2",children:[],counter:4},
					]},
					{id:2,name:"Child 2",children:[
						{id:21,name:"Child 2.1",children:[],counter:2},
						{id:21,name:"Child 2.2",children:[],counter:5},
					]},
				]};
*/
				oDataTreeTable.fnSetRootData(oData);
				oDataTreeTable.fnDraw();
			},
			dataType: "json",
			cache:false
		});
		
	};
	oDataTreeTable.fnDrawHeader();
	oDataTreeTable.fnReloadAjax();
	document.oDataTreeTable=oDataTreeTable;
} );   
        </script>
    </head>
    <body>
	    <h1><img id="logo" src="resource/images/logo.png" alt="Logo" />Simon Console: Tree</h1>
	    <div class="filterButtons fg-toolbar ui-toolbar">
		    <a id="listLink" href="index.html">List view</a>
	    </div>
	    <div id="filter">
		    <div class="filterButtons fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-corner-bl ui-corner-br ui-helper-clearfix">
			    <button id="refreshButton" name="refreshButton">Refresh</button>
			    <button id="resetAllButton" name="resetAllButton">Reset all</button>
			    <span id="exportSpan">Export:</span>
			    <button id="xmlButton" name="xmlButton">XML</button>
		    </div>
	    </div>
	    <div id="data">
		    <div class="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix" style="height:20px;"></div>
		    <table id="dataTreeTable" class="dataTreeTable">
			    
		    </table>
		    <div class="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix" style="height:20px;"></div>
	    </div>
    </body>
</html>
