<!DOCTYPE html>
<html>
    <head>
        <title>Simon Console: Tree</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link  href="resource/css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css" />
        <link  href="resource/css/javasimon.css" rel="stylesheet" type="text/css" />
        <script src="resource/js/jquery-1.7.1.min.js" type="text/javascript"></script>
        <script src="resource/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
        <script src="resource/js/javasimon-filter.js" type="text/javascript"></script>
        <script src="resource/js/javasimon-dataTreeTable.js" type="text/javascript"></script>
        <script type="text/javascript">
$(document).ready(function() {
	var oFilterCtrl=new javasimon.FilterController();
	oFilterCtrl.fnGetVal=function() {
		return {};
	};
	document.oFilterCtrl=oFilterCtrl;
	$('#listLink')
		.button();
	$('#refreshButton')
		.button({label:"Refresh",icons: {primary: "ui-icon-search"}})
		.click(function() {document.oDataTreeTable.fnReloadAjax(); return false; });
	$('#resetAllButton')
		.button({label:"Reset all", icons: {primary: "ui-icon-trash"}})
		.click(function() {
			if (window.confirm("Are you sure you want to reset all monitors?")) {
				document.oFilterCtrl.fnAjaxPost('data/reset', function() {
					document.oDataTreeTable.fnReloadAjax();
				});
			}
			return false;
		});
	$('#xmlButton')
		.button({label:"XML",icons: {primary: "ui-icon-script"}})
		.click(function() {document.oFilterCtrl.fnGoToUrl('data/tree.xml'); return false; });
	var eTable=document.getElementById('dataTreeTable');
	var oDataTreeTable=new javasimon.DataTreeTable(eTable,{
			aoColumns:[
				{sTitle:"Name",		sField:"name", 		sClass:'string', 
					oImages: {
						"unknown":"resource/images/TypeUnknown.png",
						"counter":"resource/images/TypeCounter.png",
						"stopwatch":"resource/images/TypeStopwatch.png"
					},
					fnRender:function(oNode, eCell, oDataTreeTable) {
						var sType=oNode.oData["type"];
						var domUtil=javasimon.DOMUtil;
						var sImage, eImg;
						if (sType) {
							sImage=this.oImages[sType.toLowerCase()];
							if (sImage) {
								eImg=domUtil.fnAppendChildImage(eCell, sImage);
								domUtil.fnSetClasses(eImg, ["icon"]);
							}
						}
						// Fix name
						var sValue=oNode.oData[this.sField];
						if (oNode.oParent!==null) {
							var sParentValue=oNode.oParent.oData[this.sField];
							if (sValue.substring(0,sParentValue.length)===sParentValue) {
								sValue=sValue.substring(sParentValue.length);
								if (sValue.charAt(0)==='.') {
									sValue=sValue.substring(1);
								}
							}
						}		
						if (sValue==="") {
							sValue="-";
						}
						domUtil.fnAppendChildText(eCell, sValue);
						domUtil.fnAppendClass(eCell, "headCell");
					}
				},
				{sTitle:"Counter",	sField:"counter",	sClass:"number"},
				{sTitle:"Total",	sField:"total",		sClass:"number" },
				{sTitle:"Min",		sField:"min",		sClass:"number" },
				{sTitle:"Mean",		sField:"mean",		sClass:"number" },
				{sTitle:"Max",		sField:"max",		sClass:"number" },
				{sTitle:"Std Dev",	sField:"standardDeviation",sClass:"number" },
				{sTitle:"Last",		sField:"last",		sClass:"number" },
				{sTitle:"First Date",	sField:"firstUsage",	sClass:"date" },
				{sTitle:"Last Date",	sField:"lastUsage",	sClass:"date"  },
				{sTitle:"",		sField:"name", 		sClass:'string', 
					fnRender:function(oNode, eCell, oDataTreeTable) {
						var sName=oNode.oData[this.sField];
						var domUtil=javasimon.DOMUtil;
						var eImg;
						if (sName) {
							eImg=domUtil.fnAppendChildElement(eCell, "img");
							eImg.setAttribute("src","resource/images/Reset.png");
							eImg.setAttribute("alt","Reset");
							eImg.onclick=function() {
								$.post("data/reset", {name:sName}, function() {
									document.oDataTreeTable.fnReloadAjax();
								})
								return false;
							};
							domUtil.fnSetClasses(eImg, ["icon"]);
						}		
						domUtil.fnAppendClass(eCell, "footCell");
					}
				}
			]
		}
	);
	oDataTreeTable.fnReloadAjax=function() {
		var oDataTreeTable=this;
		$.ajax({
			url: "data/tree.json",
			context: this,
			success: function(oData) {
/* Data for testing purposes 
				var oData={id:0,name:"",type:"unknown",children:[
					{id:1,name:"Child 1",type:"unknown",children:[
						{id:11,name:"Child 1.1",type:"stopwatch",children:[],counter:1},
						{id:11,name:"Child 1.2",type:"counter",children:[],counter:4},
					]},
					{id:2,name:"Child 2",type:"unknown",children:[
						{id:21,name:"Child 2.1",type:"stopwatch",children:[],counter:2},
						{id:21,name:"Child 2.2",type:"counter",children:[],counter:5},
					]},
				]};
*/
				oDataTreeTable.fnSetRootData(oData);
				oDataTreeTable.fnDraw();
			},
			dataType: "json",
			cache:false
		});
		
	};
	oDataTreeTable.fnDrawHeader();
	oDataTreeTable.fnReloadAjax();
	document.oDataTreeTable=oDataTreeTable;
} );   
        </script>
    </head>
    <body>
	    <h1><img id="logo" src="resource/images/logo.png" alt="Logo" />Simon Console: Tree</h1>
	    <div class="filterButtons fg-toolbar ui-toolbar">
		    <a id="listLink" href="index.html">List view</a>
	    </div>
	    <div id="filter">
		    <div class="filterButtons fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-corner-bl ui-corner-br ui-helper-clearfix">
			    <button id="refreshButton" name="refreshButton">Refresh</button>
			    <button id="resetAllButton" name="resetAllButton">Reset all</button>
			    <span id="exportSpan">Export:</span>
			    <button id="xmlButton" name="xmlButton">XML</button>
		    </div>
	    </div>
	    <div id="data">
		    <div class="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix" style="height:20px;"></div>
		    <table id="dataTreeTable" class="dataTreeTable">
			    
		    </table>
		    <div class="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix" style="height:20px;"></div>
	    </div>
    </body>
</html>
