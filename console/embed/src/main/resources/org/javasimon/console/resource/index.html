<!DOCTYPE html>
<html>
    <head>
        <title>Simon Console</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link  href="resource/css/javasimon.css" rel="stylesheet" type="text/css" />
        <link  href="resource/css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css" />
        <script src="resource/js/jquery-1.7.1.min.js" type="text/javascript"></script>
        <script src="resource/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
        <script src="resource/js/jquery-dataTables-1.8.2.js" type="text/javascript"></script>
        <script src="resource/js/jquery-dataTables-reloadAjax.js" type="text/javascript"></script>
        <script src="resource/js/jquery-getUrlParam.js" type="text/javascript"></script>
        <script type="text/javascript">
$(document).ready(function() {
    $('#patternText').val($(document).getUrlParam('pattern'));
    $('#typeSelect').val($(document).getUrlParam('type'));
    $('#filterButton')
        .button({label:"Filter",icons: {primary: "ui-icon-search"}})
        .click(function() { $('#dataTable').dataTable().fnReloadAjax(); return false; });
    $('#noteButton')
        .button({label:"Note", icons: {primary: "ui-icon-note"}})
        .click(function() { toggleNoteColumnVis(); return false; });
    $('#csvButton')
        .button({label:"CSV", icons: {primary: "ui-icon-calculator"}})
        .click(function() {goToUrl('data/table.csv'); return false; });
    $('#htmlButton')
        .button({label:"HTML",icons: {primary: "ui-icon-print"}})
        .click(function() {goToUrl('data/table.html'); return false; });
    $('#xmlButton')
        .button({label:"XML",icons: {primary: "ui-icon-script"}})
        .click(function() {goToUrl('data/tree.xml'); return false; });
    var oDataTable=$('#dataTable').dataTable( {
        "bJQueryUI": true,
        "bProcessing": true,
        "bAutoWidth":false,
        "sAjaxSource": 'data/table.json',
        "fnServerData": function( sUrl, aoData, fnCallback ) {
            var sPattern= $("#patternText").val();
            if (sPattern === undefined) {
                sPattern="";
            } 
            aoData.push( { "name": "pattern", "value": sPattern } );
            var sType=$("#typeSelect").val();
            if (sType === undefined) {
                sType="";
            } 
            aoData.push( { "name": "type", "value": sType } );
            $.ajax( {
                "url": sUrl,
                "data": aoData,
                "success": function(json) {
                    if (json.aaData === undefined) {
                        json = {
                            "aaData":json
                        };
                    }
                    fnCallback(json);
                },
                "dataType": "json",
                "cache":false
            } );
        },
        "aoColumns": [
            {"sTitle":"Name", "mDataProp": "name","bSearchable": true,"sType":"string","sWidth": "40%"},
            {"sTitle":"Note", "mDataProp": "note","bSearchable": true,"sType":"string","sWidth": "40%","bVisible":false},
            {"sTitle":"Type", "mDataProp": "type","bSearchable": false,"sType":"string","sWidth": "5%"},
            {"sTitle":"Count", "mDataProp": "counter","bSearchable": false,"sType":"numeric","sWidth": "5%","sClass":"numeric"},
            {"sTitle":"Total", "mDataProp": "total","bSearchable": false,"sType":"numeric","sWidth": "5%","sClass":"numeric" },
            {"sTitle":"Min", "mDataProp": "min","bSearchable": false,"sType":"numeric","sWidth": "5%","sClass":"numeric" },
            {"sTitle":"Mean", "mDataProp": "mean","bSearchable": false,"sType":"numeric","sWidth": "5%","sClass":"numeric" },
            {"sTitle":"Max", "mDataProp": "max","bSearchable": false,"sType":"numeric","sWidth": "5%","sClass":"numeric" },
            {"sTitle":"Std Dev", "mDataProp": "standardDeviation","bSearchable": false,"sType":"numeric","sWidth": "5%","sClass":"numeric" },
            {"sTitle":"Last", "mDataProp": "last","bSearchable": false,"sType":"numeric","sWidth": "5%","sClass":"numeric" },
            {"sTitle":"First Date", "mDataProp": "firstUsage","bSearchable": false,"sWidth": "10%","sClass":"numeric" },
            {"sTitle":"Last Date", "mDataProp": "lastUsage","bSearchable": false,"sWidth": "10%","sClass":"numeric"  },
            {"sTitle":"Note", "mDataProp": "note","bSearchable": true, "bVisible": false ,"sType":"string"}
        ],
        "aaSorting": [[ 3, "desc" ]]
    } );
    $(window).bind('resize', function () {
        oDataTable.fnAdjustColumnSizing();
    } );
} );   
function goToUrl(url) {
    var sPattern= $("#patternText").val();
    if (sPattern === undefined) {
        sPattern="";
    } 
    var sType=$("#typeSelect").val();
    if (sType === undefined) {
        sType="";
    }     
    window.location.href=url+"?pattern="+sPattern+"&type="+sType;
}
function toggleNoteColumnVis() {
	var oDataTable = $('#dataTable').dataTable();     
	var bNoteColumnVis = oDataTable.fnSettings().aoColumns[1].bVisible;
	oDataTable.fnSetColumnVis(0,  bNoteColumnVis);
	oDataTable.fnSetColumnVis(1, !bNoteColumnVis);
}
        </script>
    </head>
    <body>
        <h1><img id="logo" src="resource/images/logo.png" alt="Logo" />Simon Console</h1>
        <div id="filter">
            <div class="filterTitle fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix">Filtering</div>
            <form id="filterForm">
            <table>
                <tr>
                    <td>Pattern</td>
                    <td><input id="patternText" name="pattern" type="text" size="64"/></td>
                </tr>
                <tr>
                    <td>Type</td>
                    <td>
                        <select id="typeSelect" name="type">
                            <option value=""></option>
                            <option value="stopwatch">Stopwatch</option>
                            <option value="counter">Counter</option>
                            <option value="unknown">Unknown</option>
                        </select>
                    </td>
                </tr>
            </table>
            <div class="filterButtons fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix">
                <button id="filterButton" name="filterButton">Filter</button>
                <button id="noteButton" name="noteButton">Note</button>
                <span id="exportSpan">Export:</span>
                <button id="csvButton" name="csvButton">CSV</button>
                <button id="htmlButton" name="htmlButton">HTML</button>
                <button id="xmlButton" name="xmlButton">XML</button>
            </div>
            </form>
        </div>
        <div id="data">
            <table id="dataTable">
                
            </table>
        </div>
    </body>
</html>
