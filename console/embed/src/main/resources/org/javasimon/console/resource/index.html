<!DOCTYPE html>
<html>
    <head>
        <title>Simon Console</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link  href="resource/css/start/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css" />
        <link  href="resource/css/javasimon.css" rel="stylesheet" type="text/css" />
        <script src="resource/js/jquery-1.7.1.min.js" type="text/javascript"></script>
        <script src="resource/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
        <script src="resource/js/jquery-dataTables-1.8.2.js" type="text/javascript"></script>
        <script src="resource/js/jquery-dataTables-reloadAjax.js" type="text/javascript"></script>
        <script src="resource/js/jquery-getUrlParam.js" type="text/javascript"></script>
        <script src="resource/js/javasimon-filter.js" type="text/javascript"></script>
        <script src="resource/js/javasimon-service.js" type="text/javascript"></script>
        <script type="text/javascript">
$(document).ready(function() {
	var oFilterCtrl=new javasimon.FilterController($('#patternText'),$('#typeSelect'));
	oFilterCtrl.fnSetValFromUrlParams();
	document.oFilterCtrl=oFilterCtrl;

	$('#treeLink')
		.button();
	$('#filterButton')
		.button({label:"Filter",icons: {primary: "ui-icon-search"}})
		.click(function() {document.oDataTable.fnReloadAjax(); return false; });
	$('#noteButton')
		.button({label:"Note", icons: {primary: "ui-icon-note"}})
		.click(function() {document.oDataTable.fnToggleNoteColumnVis(); return false; });
	$('#resetAllButton')
		.button({label:"Reset all", icons: {primary: "ui-icon-trash"}})
		.click(function() {
			document.oFilterCtrl.fnResetAll(function() {
				document.oDataTable.fnReloadAjax();
			});
			return false;
		});
	$('#csvButton')
		.button({label:"CSV", icons: {primary: "ui-icon-calculator"}})
		.click(function() {document.oFilterCtrl.fnExportCsv(); return false; });
	$('#htmlButton')
		.button({label:"HTML",icons: {primary: "ui-icon-print"}})
		.click(function() {document.oFilterCtrl.fnExportHtml(); return false; });
	var oDataTable=$('#dataTable').dataTable( {
		bJQueryUI: true,
		bProcessing: true,
		bAutoWidth:false,
		sAjaxSource: 'data/table.json',
		fnServerData: function( sUrl, aoData, fnCallback ) {
			var oVal=document.oFilterCtrl.fnGetVal();
			aoData.push( { name: "pattern", value: oVal.sPattern } );
			aoData.push( { name: "type", value: oVal.sType } );
			javasimon.TableService.fnGetDataAsJson(aoData, function(json) {
				if (json.aaData === undefined) {
					json = {
						"aaData":json
					};
				}
				fnCallback(json);
			});
		},
		aoColumns: [
			{sTitle:"Name", mDataProp: "name",bSearchable: true,sType:"string",sWidth: "40%"},
			{sTitle:"Note", mDataProp: "note",bSearchable: true,sType:"string",sWidth: "40%",bVisible:false},
			{sTitle:"Type", mDataProp: "type",bSearchable: false,sType:"string",bUseRendered:false,
				fnRender:function(oObject) {
					var sType=oObject.aData[this.mDataProp];
					var sImage, oImages;
					var sResult="";
					if (sType) {
						oImages={
							"unknown":"resource/images/TypeUnknown.png",
							"counter":"resource/images/TypeCounter.png",
							"stopwatch":"resource/images/TypeStopwatch.png"
						};
						sImage=oImages[sType.toLowerCase()];
						if (sImage) {
							sResult="<img src=\""+sImage
								+"\" class=\"icon\" />";
								+"\" alt=\""+sType+"\" />";
						}
					}
					return sResult;
				}
			},
			{sTitle:"Count", mDataProp: "counter",bSearchable: false,sType:"numeric",sWidth: "5%",sClass:"numeric",asSorting: ["desc","asc" ] },
			{sTitle:"Total", mDataProp: "total",bSearchable: false,sType:"numeric",sWidth: "5%",sClass:"numeric",asSorting: ["desc","asc" ] },
			{sTitle:"Min", mDataProp: "min",bSearchable: false,sType:"numeric",sWidth: "5%",sClass:"numeric",asSorting: ["desc","asc" ] },
			{sTitle:"Mean", mDataProp: "mean",bSearchable: false,sType:"numeric",sWidth: "5%",sClass:"numeric",asSorting: ["desc","asc" ] },
			{sTitle:"Max", mDataProp: "max",bSearchable: false,sType:"numeric",sWidth: "5%",sClass:"numeric",asSorting: ["desc","asc" ] },
			{sTitle:"Std Dev", mDataProp: "standardDeviation",bSearchable: false,sType:"numeric",sWidth: "5%",sClass:"numeric" },
			{sTitle:"Last", mDataProp: "last",bSearchable: false,sType:"numeric",sWidth: "5%",sClass:"numeric",asSorting: ["desc","asc" ] },
			{sTitle:"First Date", mDataProp: "firstUsage",bSearchable: false,sWidth: "10%",sClass:"numeric" },
			{sTitle:"Last Date", mDataProp: "lastUsage",bSearchable: false,sWidth: "10%",sClass:"numeric",asSorting: ["desc","asc" ] },
			{sTitle:"", mDataProp: "type",sWidth: "5%" ,sType:"string",bUseRendered:false,bSortable:false,sClass:"footCell",
				fnRender:function(oObject) {
					var sName=oObject.aData["name"];
					var sResult="";
					if (sName) {
						sResult="<img src=\"resource/images/Reset.png\" "
							+"class=\"icon\" "
							+"alt=\"Reset\" "
							+"onclick=\"document.oDataTable.fnReset('"+sName+"');return false;\" "
							+"/>";
					}
					return sResult;
				}
			}
		],
		aaSorting: [[ 3, "desc" ]]
	} );
	oDataTable.fnToggleNoteColumnVis=function() {
		var bNoteColumnVis = this.fnSettings().aoColumns[1].bVisible;
		this.fnSetColumnVis(0,  bNoteColumnVis);
		this.fnSetColumnVis(1, !bNoteColumnVis);
	};
	oDataTable.fnReset=function(sName) {
		javasimon.ResetService.fnResetOne(sName, function() {
			document.oDataTable.fnReloadAjax();
		})
	};

	document.oDataTable=oDataTable;
	$(window).bind('resize', function () {
		document.oDataTable.fnAdjustColumnSizing();
	} );
} );

        </script>
    </head>
    <body>
        <h1><img id="logo" src="resource/images/logo.png" alt="Logo" />Simon Console</h1>
	<div class="filterButtons fg-toolbar ui-toolbar">
		<a id="treeLink" href="tree.html">Tree view</a>
	</div>
        <div id="filter">
            <div class="filterTitle fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix">Filtering</div>
            <form id="filterForm">
            <table>
                <tr>
                    <td>Pattern</td>
                    <td><input id="patternText" name="pattern" type="text" size="64"/></td>
                </tr>
                <tr>
                    <td>Type</td>
                    <td>
                        <select id="typeSelect" name="type">
                            <option value=""></option>
                            <option value="stopwatch">Stopwatch</option>
                            <option value="counter">Counter</option>
                            <option value="unknown">Unknown</option>
                        </select>
                    </td>
                </tr>
            </table>
            <div class="filterButtons ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix">
                <button id="filterButton" name="filterButton">Filter</button>
                <button id="noteButton" name="noteButton">Note</button>
                <button id="resetAllButton" name="resetAllButton">Reset all</button>
                <span id="exportSpan">Export:</span>
                <button id="csvButton" name="csvButton">CSV</button>
                <button id="htmlButton" name="htmlButton">HTML</button>
            </div>
            </form>
        </div>
        <div id="data">
            <table id="dataTable">

            </table>
        </div>
    </body>
</html>
